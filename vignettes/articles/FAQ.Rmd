---
title: "FAQ"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
    collapse = TRUE,
    comment = "#>"
)
```

```{r setup}
library(ggalign)
```

```{r setup_data}
set.seed(123)
small_mat <- matrix(rnorm(81), nrow = 9)
rownames(small_mat) <- paste0("row", seq_len(nrow(small_mat)))
colnames(small_mat) <- paste0("column", seq_len(ncol(small_mat)))
```

## Why I cannot add a dendrogram with `reorder_group = TRUE` behind a dendrogram with `reorder_group = FALSE`?

> Note: We always prevent users from reordering the layout axis twice.

When `reorder_group = FALSE` is used, reordering of the heatmap occurs within
each group. As long as the ordering within each group remains consistent, these
two dendrograms can be placed on the same axis of the heatmap. 

Let's assume that panels represents the group for each observation and index
represents the ordered index of the observations. 

In the code provided, panels is initialized as ungrouped and index as unordered: 
```{r}
panels <- NULL
index <- NULL
```

```{r}
set.seed(2L)
group <- sample(letters[1:3], ncol(small_mat), replace = TRUE)
h <- ggheatmap(small_mat) +
    hmanno("t") +
    align_group(group)
```

This dose initialized the `panels`.
```{r}
panels <- factor(group)
```

When we add a dendrogram with `reorder_group = FALSE`; this'll do something
like this (Since `reorder_group = FALSE`, the `panels` won't be changed): 
```{r}
h <- h + align_dendro(reorder_group = FALSE)
# always remember dendrogram will initialize the index, here, we extract the
# index from the underlying dendrogram
index <- stats::order.dendrogram(ggalign_stat(h, "top", 2L))
```

However, if a dendrogram with `reorder_group = TRUE` is added, it will reorder the
panels. Here, the panel levels are sampled to create new groups: 
```{r}
panels <- factor(panels, sample(levels(panels)))
new_index <- unlist(split(index, panels[index]),
    recursive = FALSE, use.names = FALSE
)
all(index == new_index)
```

```{r error=TRUE}
h + align_dendro(reorder_group = TRUE)
```

To prevent reordering of the layout axis twice, we ensure that the `new_index`
matches the `index` (if `index` is not NULL). This is done to maintain
consistency and prevent conflicts in the ordering of the heatmap.

## Can I change the default data for all geoms?
All function in `ggalign` requires specific data formats for its operations. If
you need to transform or filter data for individual `geoms`, you can use the
`data` argument within each `geom`. However, if you have multiple `geoms` and
want a consistent transformation applied across all, you can utilize the
`plot_data` argument in the `ggalign()` or `ggpanel()` function. This allows you
to transform the default data for all additive geoms.

## Session information
```{r}
sessionInfo()
```
